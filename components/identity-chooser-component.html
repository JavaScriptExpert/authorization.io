<div class="row">
  <div class="col-sm-12">
    <!-- <br-headline
      ng-if="!($ctrl.identities | isEmpty) || !$ctrl.enableRegistration"
      br-title="{{$ctrl.display.loginForm && 'Login' || 'Select an Identity'}}"
      br-options="{menu:false}"></br-headline> -->
    <stackable-modal stackable="$ctrl.showAddIdentityModal"
      stackable-closed="!err && $ctrl.identityAdded(result)"
      br-lazy-compile="$ctrl.showAddIdentityModal"
      br-lazy-id="aio-add-identity-modal">
      <!-- TODO: include identity filter as parameter to modal -->
      <aio-add-identity-modal></aio-add-identity-modal>
    </stackable-modal>
    <!-- <hr> -->
    <ul class="list-unstyled">
      <li class="br-item-hover well" ng-repeat="(id, identity) in $ctrl.identities"
        ng-click="$ctrl.select(id)">
        <div class="row">
          <!-- TODO: move style to less -->
          <div class="col-sm-12" style="height 80px; padding: 10px;">
            <!-- <i class="fa fa-user fa-3x pull-left" style="padding-left: 8px"></i> -->
            <span class="fa-stack fa-lg pull-left">
              <i class="fa fa-user fa-stack-2x"></i>
              <i ng-if="!$ctrl.isAuthenticated(identity.id)"
                class="fa fa-lock fa-stack-1x" style="margin-top: -7px; margin-left: 20px"
                br-tooltip="This identity is password-protected."></i>
              <i ng-if="$ctrl.isAuthenticated(identity.id)"
                class="fa fa-unlock fa-stack-1x" style="margin-top: -7px; margin-left: 20px"
                br-tooltip="This identity is not password-protected or its password was entered recently."></i>
            </span>
            <div class="text" style="margin-left: 60px;">
              <strong>{{identity.label}}</strong>
              <h6 class="text-muted" style="margin-top: 4px; margin-bottom: 4px;">Managed by {{identity.sysRepoDomain || 'Loading repository information...'}}</h6>
            </div>
          </div>
        </div>
        <div ng-show="$ctrl.display.loginForm && $ctrl.selected === id">
          <form class="form-horizontal" name="$ctrl.loginForm"
            ng-submit="$ctrl.authenticate(id, $ctrl.password)">
            <fieldset>
              <br-input br-model="$ctrl.password"
                br-options="{
                  name: 'password',
                  label: 'Password',
                  type: 'password',
                  helpTogglePosition: 'label',
                  showValidation: true,
                  autofocus: true
                }" required>
                <br-input-help>
                  Please enter the password to unlock this identity.
                </br-input-help>
                <br-input-validation-errors>
                  <p ng-show="$ctrl.loginForm.password.$error.required">
                    A password is required to unlock this identity.
                  </p>
                </br-input-validation-errors>
              </br-input>
              <div class="form-group">
                <div class="input-group col-sm-offset-3">
                  <div class="btn-group">
                    <button class="btn btn-primary" type="submit"
                      ng-disabled="$ctrl.loginForm.$invalid"><i
                      class="fa fa-sign-in"></i> Login<span
                        ng-show="$ctrl.authenticating"> <i class="fa fa-refresh fa-spin"></i></span></button>
                  </div>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </li>
    </ul>
    <div ng-if="!$ctrl.enableRegistration && ($ctrl.identities | isEmpty)">
      <div class="alert alert-warning"><strong>No identities found</strong>.</div>
      <p>
        Please <a ng-click="$ctrl.showAddIdentityModal=true">register
        an existing identity with this device</a> or visit a digital
        wallet provider of your choice to create a new one.
      </p>
    </div>
    <div ng-if="!($ctrl.identities | isEmpty)">
      <h4><a ng-click="$ctrl.showAddIdentityModal=true"><strong><i class="fa fa-plus"></i> Add Identity</strong></a></h4>
    </div>
  </div>
</div>
<div ng-if="$ctrl.enableRegistration && ($ctrl.identities | isEmpty)"
  class="row">
  <div class="col-xs-12 text-center">
    <p>
      To enable sign in with this device, you must get a digital wallet.
    </p>
    <button class="btn btn-primary" type="button"
      ng-click="$ctrl.onIdentitySelected({identity: null})"><i
      class="fa fa-arrow-right"></i> Get a Wallet<span></button>
    <hr>
    <a ng-click="$ctrl.showAddIdentityModal=true">I already have a wallet that I want to use with this device.</a>
  </div>
</div>
